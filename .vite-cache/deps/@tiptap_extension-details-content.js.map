{
  "version": 3,
  "sources": ["../../node_modules/@tiptap/extension-details-content/src/details-content.ts"],
  "sourcesContent": ["import {\n  defaultBlockAt,\n  findParentNode,\n  mergeAttributes,\n  Node,\n} from '@tiptap/core'\nimport { Selection } from '@tiptap/pm/state'\nimport type { ViewMutationRecord } from '@tiptap/pm/view'\n\nexport interface DetailsContentOptions {\n  /**\n   * Custom HTML attributes that should be added to the rendered HTML tag.\n   */\n  HTMLAttributes: {\n    [key: string]: any\n  },\n}\n\nexport const DetailsContent = Node.create<DetailsContentOptions>({\n  name: 'detailsContent',\n\n  content: 'block+',\n\n  defining: true,\n\n  selectable: false,\n\n  addOptions() {\n    return {\n      HTMLAttributes: {},\n    }\n  },\n\n  parseHTML() {\n    return [\n      {\n        tag: `div[data-type=\"${this.name}\"]`,\n      },\n    ]\n  },\n\n  renderHTML({ HTMLAttributes }) {\n    return [\n      'div',\n      mergeAttributes(this.options.HTMLAttributes, HTMLAttributes, { 'data-type': this.name }),\n      0,\n    ]\n  },\n\n  addNodeView() {\n    return ({ HTMLAttributes }) => {\n      const dom = document.createElement('div')\n      const attributes = mergeAttributes(\n        this.options.HTMLAttributes,\n        HTMLAttributes,\n        {\n          'data-type': this.name,\n          hidden: 'hidden',\n        },\n      )\n\n      Object.entries(attributes).forEach(([key, value]) => dom.setAttribute(key, value))\n\n      dom.addEventListener('toggleDetailsContent', () => {\n        dom.toggleAttribute('hidden')\n      })\n\n      return {\n        dom,\n        contentDOM: dom,\n        ignoreMutation(mutation: ViewMutationRecord) {\n          if (mutation.type === 'selection') {\n            return false\n          }\n\n          return !dom.contains(mutation.target) || dom === mutation.target\n        },\n        update: updatedNode => {\n          if (updatedNode.type !== this.type) {\n            return false\n          }\n\n          return true\n        },\n      }\n    }\n  },\n\n  addKeyboardShortcuts() {\n    return {\n      // Escape node on double enter\n      Enter: ({ editor }) => {\n        const { state, view } = editor\n        const { selection } = state\n        const { $from, empty } = selection\n        const detailsContent = findParentNode(node => node.type === this.type)(selection)\n\n        if (!empty || !detailsContent || !detailsContent.node.childCount) {\n          return false\n        }\n\n        const fromIndex = $from.index(detailsContent.depth)\n        const { childCount } = detailsContent.node\n        const isAtEnd = childCount === fromIndex + 1\n\n        if (!isAtEnd) {\n          return false\n        }\n\n        const defaultChildType = detailsContent.node.type.contentMatch.defaultType\n        const defaultChildNode = defaultChildType?.createAndFill()\n\n        if (!defaultChildNode) {\n          return false\n        }\n\n        const $childPos = state.doc.resolve(detailsContent.pos + 1)\n        const lastChildIndex = childCount - 1\n        const lastChildNode = detailsContent.node.child(lastChildIndex)\n        const lastChildPos = $childPos.posAtIndex(lastChildIndex, detailsContent.depth)\n        const lastChildNodeIsEmpty = lastChildNode.eq(defaultChildNode)\n\n        if (!lastChildNodeIsEmpty) {\n          return false\n        }\n\n        // get parent of details node\n        const above = $from.node(-3)\n\n        if (!above) {\n          return false\n        }\n\n        // get default node type after details node\n        const after = $from.indexAfter(-3)\n        const type = defaultBlockAt(above.contentMatchAt(after))\n\n        if (!type || !above.canReplaceWith(after, after, type)) {\n          return false\n        }\n\n        const node = type.createAndFill()\n\n        if (!node) {\n          return false\n        }\n\n        const { tr } = state\n        const pos = $from.after(-2)\n\n        tr.replaceWith(pos, pos, node)\n\n        const $pos = tr.doc.resolve(pos)\n        const newSelection = Selection.near($pos, 1)\n\n        tr.setSelection(newSelection)\n\n        const deleteFrom = lastChildPos\n        const deleteTo = lastChildPos + lastChildNode.nodeSize\n\n        tr.delete(deleteFrom, deleteTo)\n        tr.scrollIntoView()\n        view.dispatch(tr)\n\n        return true\n      },\n    }\n  },\n})\n"],
  "mappings": "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",
  "names": ["node"]
}
