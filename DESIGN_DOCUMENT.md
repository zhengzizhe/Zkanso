# Zkanso å¯Œæ–‡æœ¬ç¼–è¾‘å™¨ - å®Œæ•´è®¾è®¡æ–‡æ¡£

## ğŸ“‹ æ–‡æ¡£æ¦‚è¿°

æœ¬æ–‡æ¡£æŒ‡å¯¼å¦‚ä½•é›†æˆ Tiptap çš„å®˜æ–¹æ‰©å±•ï¼Œæ„å»ºä¸€ä¸ªåŠŸèƒ½å®Œæ•´ã€ä½“éªŒä¼˜ç§€çš„åœ¨çº¿æ–‡æ¡£ç¼–è¾‘å™¨ï¼Œå‚è€ƒé£ä¹¦/Craftç­‰äº§å“çš„è®¾è®¡ç†å¿µã€‚

**ç›®æ ‡**: å»ºç«‹ä¸€ä¸ªæ¨¡å—åŒ–ã€å¯æ‰©å±•ã€é«˜æ€§èƒ½çš„å¯Œæ–‡æœ¬ç¼–è¾‘ç³»ç»Ÿ

---

## ç¬¬ä¸€éƒ¨åˆ†ï¼šäº§å“åˆ†æä¸è®¾è®¡ç›®æ ‡

### 1.1 ç«å“å‚è€ƒåˆ†æ

#### é£ä¹¦æ–‡æ¡£ç‰¹æ€§
- **å—çº§ç¼–è¾‘**: æ¯ä¸ªæ®µè½/åˆ—è¡¨é¡¹å¯ç‹¬ç«‹æ“ä½œ
- **å®æ—¶åä½œ**: å¤šäººåŒæ—¶ç¼–è¾‘ï¼Œå…‰æ ‡å®æ—¶åŒæ­¥
- **ä¸°å¯Œäº¤äº’**: æ–œæ èœå•ã€å¿«æ·é”®ã€æ‹–æ”¾æ’åº
- **é«˜æ•ˆæ’ç‰ˆ**: è¡¨æ ¼ã€åˆ†æ ã€å¤šåª’ä½“åµŒå…¥
- **æ€§èƒ½ä¼˜åŒ–**: è™šæ‹Ÿæ»šåŠ¨ã€å¢é‡æ›´æ–°

#### Craftè®¾è®¡ç†å¿µ
- **ç®€æ´ä¼˜é›…**: æœ€å°åŒ–ç•Œé¢å¹²æ‰°
- **åŠ¿èƒ½æ„Ÿ**: å—å…ƒç´ æ˜¾ç¤ºæ‹–æ‹½æ‰‹æŸ„
- **è§†è§‰å±‚çº§**: æ¸…æ™°çš„ç¼©è¿›å’Œé—´è·
- **é”®ç›˜ä¼˜å…ˆ**: å…¨å¿«æ·é”®æ“ä½œæµç¨‹
- **æ¸è¿›åŠŸèƒ½**: æŒ‰éœ€æ˜¾ç¤ºé«˜çº§åŠŸèƒ½

### 1.2 ç›®æ ‡æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         ç¼–è¾‘å™¨å®¹å™¨ (EditorContainer)     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   ç¼–è¾‘åŒºåŸŸ (TiptapEditor)        â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  å—èœå• (SlashCommand)     â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  æµ®åŠ¨å·¥å…·æ  (Toolbar)      â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  æ‹–æ”¾æŒ‡ç¤ºçº¿ (Dropcursor)   â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  ååŒå…‰æ ‡ (Collaboration)  â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  çŠ¶æ€æ  (StatusBar): å­—æ•°ç»Ÿè®¡ã€ä½ç½®    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ç¬¬äºŒéƒ¨åˆ†ï¼šæ‰©å±•é›†æˆè§„åˆ’

### 2.1 å·²é›†æˆçš„æ‰©å±• (4ä¸ª)

#### âœ… StarterKit (é¢„ç»„åˆåŒ…)
- **ç°çŠ¶**: å·²é›†æˆ
- **åŒ…å«**: Document, Paragraph, Text, Heading, Bold, Italic, CodeBlock, Blockquoteç­‰
- **æ— éœ€é‡å¤é›†æˆ**

#### âœ… Underline
- **ç°çŠ¶**: å·²é›†æˆ
- **ç”¨é€”**: æ–‡æœ¬ä¸‹åˆ’çº¿

#### âœ… Link
- **ç°çŠ¶**: å·²é›†æˆ
- **é…ç½®**: openOnClick: false

#### âœ… TaskList / TaskItem
- **ç°çŠ¶**: å·²é›†æˆ
- **ç”¨é€”**: ä»»åŠ¡åˆ—è¡¨ï¼ˆå¤é€‰æ¡†ï¼‰

---

### 2.2 å¾…é›†æˆçš„æ ¸å¿ƒæ‰©å±• (ç¬¬ä¸€é˜¶æ®µ)

#### ğŸ“Œ **Highlight** (æ–‡æœ¬é«˜äº®)
**å‚è€ƒ**: é£ä¹¦çš„æ ‡è®°åŠŸèƒ½  
**åŠŸèƒ½**: ä¸ºæ–‡æœ¬æ·»åŠ èƒŒæ™¯è‰²

```typescript
// é…ç½®
Highlight.configure({
  multicolor: true  // æ”¯æŒå¤šç§é¢œè‰²
})

// ä½¿ç”¨åœºæ™¯
- æ ‡è®°é‡ç‚¹å†…å®¹ï¼ˆé»„è‰²ã€çº¢è‰²ã€ç»¿è‰²ç­‰ï¼‰
- æ”¯æŒé¢œè‰²é€‰æ‹©å™¨
- ç¼–è¾‘èœå•ä¸­æ˜¾ç¤ºé¢œè‰²é¢æ¿

// é¢„æœŸæ ·å¼
.ProseMirror mark {
  background: linear-gradient(120deg, #ffd700, #ffa500);
  padding: 2px 4px;
  border-radius: 3px;
  transition: background 0.2s;
}

// å¿«æ·é”®
Ctrl/Cmd + Shift + H (æ‰“å¼€é¢œè‰²é€‰æ‹©)
```

**å®ç°æ­¥éª¤**:
1. å®‰è£…: `npm install @tiptap/extension-highlight@^2.27.1`
2. åœ¨ `toolbar-test.tsx` å¯¼å…¥é…ç½®
3. åˆ›å»º `styles/highlight.css` é…ç½®æ ·å¼
4. åœ¨æµ®åŠ¨å·¥å…·æ ä¸­æ·»åŠ é¢œè‰²é€‰æ‹©æŒ‰é’®
5. æ·»åŠ é”®ç›˜å¿«æ·é”®æ”¯æŒ

---

#### ğŸ“Œ **Image** (å›¾ç‰‡æ’å…¥)
**å‚è€ƒ**: é£ä¹¦çš„å›¾ç‰‡ä¸Šä¼ å’Œç®¡ç†  
**åŠŸèƒ½**: æ”¯æŒå›¾ç‰‡ä¸Šä¼ ã€è°ƒæ•´å¤§å°ã€å¯¹é½

```typescript
// é…ç½®
Image.configure({
  inline: false,           // å›¾ç‰‡å•ç‹¬å ç”¨ä¸€è¡Œ
  HTMLAttributes: {
    class: 'editor-image',
    draggable: true
  }
})

// ä½¿ç”¨åœºæ™¯
- ä»æœ¬åœ°ä¸Šä¼ å›¾ç‰‡
- ä»URLç²˜è´´å›¾ç‰‡
- æ‹–æ”¾å›¾ç‰‡åˆ°ç¼–è¾‘å™¨
- è°ƒæ•´å›¾ç‰‡å¤§å°
- è®¾ç½®å›¾ç‰‡å¯¹é½æ–¹å¼ï¼ˆå·¦ã€ä¸­ã€å³ï¼‰
- ä¸ºå›¾ç‰‡æ·»åŠ æ ‡é¢˜

// é¢„æœŸæ ·å¼
.editor-image {
  max-width: 100%;
  height: auto;
  border-radius: 8px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  transition: box-shadow 0.2s;
  margin: 1em 0;
}

.editor-image:hover {
  box-shadow: 0 4px 16px rgba(0,0,0,0.15);
  cursor: move;
}

// åŠŸèƒ½ç‰¹æ€§
- ä¸Šä¼ è¿›åº¦æ¡
- å›¾ç‰‡æ‡’åŠ è½½
- æ™ºèƒ½ç¼©æ”¾
- å³é”®èœå•ï¼ˆåˆ é™¤ã€æ›¿æ¢ï¼‰
```

**å®ç°æ­¥éª¤**:
1. å®‰è£…: `npm install @tiptap/extension-image@^2.27.1`
2. åˆ›å»º `components/ImageUpload.tsx` å¤„ç†ä¸Šä¼ 
3. åˆ›å»º `styles/image.css` é…ç½®æ ·å¼
4. é›†æˆåˆ°æ–œæ èœå• (`/å›¾ç‰‡`)
5. æ”¯æŒæ‹–æ”¾ä¸Šä¼ 
6. æ·»åŠ å›¾ç‰‡å¤§å°è°ƒæ•´åŠŸèƒ½

---

#### ğŸ“Œ **TextAlign** (æ–‡æœ¬å¯¹é½)
**å‚è€ƒ**: é£ä¹¦çš„å¯¹é½åŠŸèƒ½  
**åŠŸèƒ½**: å·¦å¯¹é½ã€å±…ä¸­ã€å³å¯¹é½ã€ä¸¤ç«¯å¯¹é½

```typescript
// é…ç½®
TextAlign.configure({
  types: ['heading', 'paragraph']
})

// ä½¿ç”¨åœºæ™¯
- æ ‡é¢˜å±…ä¸­
- æ®µè½å·¦å¯¹é½ï¼ˆé»˜è®¤ï¼‰
- å³å¯¹é½ï¼ˆç”¨äºç‰¹æ®Šæ’ç‰ˆï¼‰
- ä¸¤ç«¯å¯¹é½

// é¢„æœŸæ ·å¼
.text-align-left { text-align: left; }
.text-align-center { text-align: center; }
.text-align-right { text-align: right; }
.text-align-justify { text-align: justify; }

// å¿«æ·é”®
Ctrl/Cmd + Shift + L (å·¦å¯¹é½)
Ctrl/Cmd + Shift + E (å±…ä¸­)
Ctrl/Cmd + Shift + R (å³å¯¹é½)
Ctrl/Cmd + Shift + J (ä¸¤ç«¯å¯¹é½)
```

**å®ç°æ­¥éª¤**:
1. å®‰è£…: `npm install @tiptap/extension-text-align@^2.27.1`
2. åœ¨å·¥å…·æ æ·»åŠ å¯¹é½æŒ‰é’®ç»„
3. é…ç½®é”®ç›˜å¿«æ·é”®
4. åˆ›å»º `styles/textalign.css`

---

#### ğŸ“Œ **CharacterCount** (å­—æ•°ç»Ÿè®¡)
**å‚è€ƒ**: é£ä¹¦çš„å­—æ•°ç»Ÿè®¡å™¨  
**åŠŸèƒ½**: å®æ—¶æ˜¾ç¤ºå­—ç¬¦å’Œè¯æ•°

```typescript
// é…ç½®
CharacterCount.configure({
  limit: null  // ä¸é™åˆ¶å­—æ•°ï¼Œæˆ–è®¾ç½®ä¸Šé™å¦‚ 10000
})

// ä½¿ç”¨åœºæ™¯
- çŠ¶æ€æ æ˜¾ç¤º "å­—æ•°: 1234"
- å®æ—¶æ›´æ–°
- è¶…é™æ—¶æç¤ºè­¦å‘Š
- ç”¨äºSEOä¼˜åŒ–å‚è€ƒ

// å®ç°ç¤ºä¾‹
const stats = editor.storage.characterCount;
console.log(`å­—ç¬¦æ•°: ${stats.characters}, è¯æ•°: ${stats.words}`);

// é¢„æœŸå±•ç¤º
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ... | å­—æ•°: 1234 | è¯æ•°: 245        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å®ç°æ­¥éª¤**:
1. å®‰è£…: `npm install @tiptap/extension-character-count@^2.27.1`
2. åˆ›å»º `components/StatusBar.tsx` æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯
3. ç›‘å¬ `editor.storage.characterCount` å˜åŒ–
4. æ·»åŠ æ ·å¼å’ŒåŠ¨ç”»

---

### 2.3 å¾…é›†æˆçš„è¡¨æ ¼æ‰©å±• (ç¬¬äºŒé˜¶æ®µ)

#### ğŸ“Œ **Table / TableRow / TableHeader / TableCell** (è¡¨æ ¼)
**å‚è€ƒ**: é£ä¹¦çš„è¡¨æ ¼ç¼–è¾‘  
**åŠŸèƒ½**: åˆ›å»ºã€ç¼–è¾‘ã€ç¾åŒ–è¡¨æ ¼

```typescript
// é…ç½®
Table.configure({
  resizable: false,
  handleWidth: 2,
  cellMinWidth: 50,
  lastColumnResizable: true,
  HTMLAttributes: { class: 'editor-table' }
})

TableRow.configure({
  HTMLAttributes: { class: 'editor-table-row' }
})

TableHeader.configure({
  HTMLAttributes: { class: 'editor-table-header' }
})

TableCell.configure({
  HTMLAttributes: { class: 'editor-table-cell' }
})

// ä½¿ç”¨åœºæ™¯
- åˆ›å»ºæ•°æ®è¡¨æ ¼
- å¯¹æ ‡é¢˜è¡Œç‰¹æ®Šæ ·å¼
- å³é”®èœå•æ“ä½œï¼ˆæ’å…¥è¡Œ/åˆ—ã€åˆ é™¤ç­‰ï¼‰
- å•å…ƒæ ¼å†…æ”¯æŒå¯Œæ–‡æœ¬ç¼–è¾‘
- è¡¨æ ¼æ’åºã€ç­›é€‰ï¼ˆé«˜çº§ï¼‰

// é¢„æœŸæ ·å¼
.editor-table {
  width: 100%;
  border-collapse: collapse;
  margin: 1em 0;
  border: 1px solid #d1d5db;
  border-radius: 8px;
  overflow: hidden;
}

.editor-table-header {
  background: linear-gradient(135deg, #f3f4f6, #e5e7eb);
  font-weight: 600;
}

.editor-table-cell {
  padding: 12px;
  border: 1px solid #e5e7eb;
  transition: all 0.2s;
}

.editor-table-cell:hover {
  background: rgba(99, 102, 241, 0.05);
}

// å¿«æ·é”®
Ctrl/Cmd + Shift + T (æ’å…¥è¡¨æ ¼)
Tab (ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªå•å…ƒæ ¼)
Shift + Tab (ç§»åŠ¨åˆ°ä¸Šä¸€ä¸ªå•å…ƒæ ¼)
```

**å®ç°æ­¥éª¤**:
1. å®‰è£…4ä¸ªè¡¨æ ¼æ‰©å±•
2. åˆ›å»º `components/TableMenu.tsx` å¤„ç†è¡¨æ ¼æ“ä½œ
3. åˆ›å»º `styles/table.css` å®Œæ•´æ ·å¼
4. é›†æˆåˆ°æ–œæ èœå• (`/è¡¨æ ¼`)
5. å®ç°å³é”®èœå•
6. æ·»åŠ é”®ç›˜å¿«æ·é”®

---

### 2.4 å¾…é›†æˆçš„ååŒç¼–è¾‘æ‰©å±• (ç¬¬ä¸‰é˜¶æ®µ)

#### ğŸ“Œ **Collaboration / CollaborationCursor** (å®æ—¶åä½œ)
**å‚è€ƒ**: é£ä¹¦çš„å¤šäººç¼–è¾‘ã€Figmaçš„å®æ—¶åä½œ  
**åŠŸèƒ½**: å¤šç”¨æˆ·å®æ—¶ç¼–è¾‘ï¼Œå…‰æ ‡åŒæ­¥

```typescript
// ä¾èµ–
import * as Y from 'yjs';
import { WebsocketProvider } from 'y-websocket';

// é…ç½®
Collaboration.configure({
  document: ydoc
})

CollaborationCursor.configure({
  provider: provider,
  user: {
    name: 'John Doe',
    color: '#ff0000',
    avatar: 'https://...'
  }
})

// ä½¿ç”¨åœºæ™¯
- å¤šäººå®æ—¶ç¼–è¾‘åŒä¸€æ–‡æ¡£
- çœ‹åˆ°å…¶ä»–ç”¨æˆ·çš„å…‰æ ‡ä½ç½®å’Œåå­—
- ä¸åŒé¢œè‰²çš„å…‰æ ‡åŒºåˆ†ç”¨æˆ·
- ç”¨æˆ·å¤´åƒæ‚¬åœæ˜¾ç¤º
- å†²çªè‡ªåŠ¨è§£å†³ï¼ˆYjs CRDTç®—æ³•ï¼‰

// é¢„æœŸè¡¨ç°
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [ğŸ‘¤ å¼ ä¸‰] [ğŸ‘¤ æå››] [ğŸ‘¤ ç‹äº”]    â”‚
â”‚                                   â”‚
â”‚ è¿™æ˜¯ä¸€ä¸ª[æå››åœ¨è¿™é‡Œç¼–è¾‘]çš„æ®µè½... â”‚
â”‚         â””â”€ æå››çš„å…‰æ ‡             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

// æ ·å¼
.collaboration-cursor {
  position: absolute;
  pointer-events: none;
  border-left: 2px solid;
  margin-left: -1px;
  animation: blink 1s infinite;
}

.collaboration-cursor__label {
  position: absolute;
  top: -1.4em;
  left: -1px;
  background: currentColor;
  color: white;
  padding: 2px 6px;
  border-radius: 4px;
  font-size: 12px;
  white-space: nowrap;
}
```

**å®ç°æ­¥éª¤** (å¤æ‚ï¼Œéœ€åˆ†é˜¶æ®µ):
1. å®‰è£…: `npm install yjs y-websocket @tiptap/extension-collaboration@^2.27.1`
2. è®¾ç½® WebSocket æœåŠ¡å™¨æˆ–ä½¿ç”¨äº‘æœåŠ¡
3. åˆå§‹åŒ– Yjs æ–‡æ¡£
4. é…ç½®åä½œå…‰æ ‡
5. å¤„ç†ç”¨æˆ·çŠ¶æ€ç®¡ç†
6. å®ç°ç¦»çº¿ç¼“å­˜æœºåˆ¶
7. æ·»åŠ ç”¨æˆ·åˆ—è¡¨ç»„ä»¶

---

### 2.5 å¾…é›†æˆçš„å¢å¼ºæ‰©å±• (ç¬¬å››é˜¶æ®µ)

#### ğŸ“Œ **Gapcursor** (é—´éš™å…‰æ ‡)
**å‚è€ƒ**: Mediumã€Notionçš„å—ä¹‹é—´æ’å…¥  
**åŠŸèƒ½**: åœ¨å—å…ƒç´ ä¹‹é—´æ˜¾ç¤ºå…‰æ ‡ï¼Œæ”¯æŒæ’å…¥å…ƒç´ 

```typescript
Gapcursor.configure({
  HTMLAttributes: { class: 'ProseMirror-gapcursor' }
})

// ä½¿ç”¨åœºæ™¯
- åœ¨å›¾ç‰‡ä¸‹æ–¹æ’å…¥æ–‡å­—
- åœ¨å—çº§å…ƒç´ ä¹‹é—´æ’å…¥æ–°å—
- æ”¹è¿›çš„å—é€‰æ‹©ä½“éªŒ

// æ ·å¼
.ProseMirror-gapcursor {
  position: absolute;
  pointer-events: none;
  display: none;
}

.ProseMirror-gapcursor::after {
  content: '';
  display: block;
  height: 0;
  position: absolute;
  left: -2px;
  right: -2px;
  border-top: 1px solid #6366f1;
  animation: gapPulse 0.6s infinite;
}
```

**å®ç°æ­¥éª¤**:
1. å®‰è£…: `npm install @tiptap/extension-gapcursor@^2.27.1`
2. é…ç½®å¹¶å¯ç”¨
3. è°ƒæ•´æ ·å¼å’ŒåŠ¨ç”»

---

## ç¬¬ä¸‰éƒ¨åˆ†ï¼šäº¤äº’åŠŸèƒ½è®¾è®¡

### 3.1 æ–œæ èœå• (å·²æœ‰ï¼Œå¾…æ‰©å±•)

**ç°çŠ¶**: å·²å®ç°åŸºç¡€å‘½ä»¤  
**æ‰©å±•æ–¹æ¡ˆ**:

```
/åŸºç¡€
  â”œâ”€ æ®µè½
  â”œâ”€ æ ‡é¢˜ 1/2/3

/æ ¼å¼
  â”œâ”€ å¼•ç”¨å—
  â”œâ”€ ä»£ç å—
  â”œâ”€ åˆ†å‰²çº¿

/åˆ—è¡¨
  â”œâ”€ æ— åºåˆ—è¡¨
  â”œâ”€ æœ‰åºåˆ—è¡¨
  â”œâ”€ ä»»åŠ¡åˆ—è¡¨

/é«˜çº§
  â”œâ”€ è¡¨æ ¼
  â”œâ”€ å›¾ç‰‡
  â”œâ”€ [å¾…å®š: è§†é¢‘ã€éŸ³é¢‘]

/æç¤º
  â”œâ”€ Info
  â”œâ”€ Warning
  â”œâ”€ Success
  â”œâ”€ Error
```

**æ–°å¢å‘½ä»¤çš„æ–œæ èœå•è§¦å‘**:
- `/é«˜äº®` â†’ æ‰“å¼€é¢œè‰²é€‰æ‹©
- `/å›¾ç‰‡` â†’ æ‰“å¼€ä¸Šä¼ å¯¹è¯
- `/è¡¨æ ¼` â†’ åˆ›å»ºNÃ—Mè¡¨æ ¼
- `/å¯¹é½` â†’ é€‰æ‹©å¯¹é½æ–¹å¼

---

### 3.2 æµ®åŠ¨å·¥å…·æ  (å¾…æ‰©å±•)

**å‚è€ƒ**: é£ä¹¦çš„æµ®åŠ¨å·¥å…·æ   
**ç°çŠ¶**: åŸºç¡€ç‰ˆæœ¬å·²æœ‰  
**æ‰©å±•åŠŸèƒ½**:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ B  I  U  S  C  |  H1  H2  H3        â”‚
â”‚ åˆ—è¡¨  å¼•ç”¨  |  ğŸ¨(é«˜äº®)  ğŸ–¼ï¸(å›¾ç‰‡)   â”‚
â”‚ ... (æ›´å¤š)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ–°å¢æŒ‰é’®:
- ğŸ¨ é«˜äº®é¢œè‰² (å¤šè‰²é€‰æ‹©)
- ğŸ–¼ï¸ æ’å…¥å›¾ç‰‡
- â—¼ï¸ æ–‡æœ¬å¯¹é½ (å·¦/ä¸­/å³/ä¸¤ç«¯)
- â‹¯  æ›´å¤šèœå• (æº¢å‡º)
```

---

### 3.3 é”®ç›˜å¿«æ·é”®ä½“ç³»

**å‚è€ƒ**: Craftçš„é”®ç›˜ä¼˜å…ˆè®¾è®¡  
**è§„åˆ’**:

```
æ–‡æœ¬æ ¼å¼:
  Ctrl/Cmd + B     Bold
  Ctrl/Cmd + I     Italic
  Ctrl/Cmd + U     Underline
  Ctrl/Cmd + Shift + X  Strike
  
åˆ—è¡¨:
  Ctrl/Cmd + Shift + U  Bullet List
  Ctrl/Cmd + Shift + O  Ordered List
  
å¯¹é½:
  Ctrl/Cmd + Shift + L  Left
  Ctrl/Cmd + Shift + E  Center
  Ctrl/Cmd + Shift + R  Right
  Ctrl/Cmd + Shift + J  Justify
  
å—æ“ä½œ:
  Ctrl/Cmd + Shift + B  Blockquote
  Ctrl/Cmd + Alt + C    Code Block
  Ctrl/Cmd + Shift + H  Highlight
  Ctrl/Cmd + Alt + T    Table
  
å¯¼èˆª:
  /         Slash Menu
  Tab       Indent
  Shift+Tab Outdent
```

---

## ç¬¬å››éƒ¨åˆ†ï¼šæ ·å¼ç³»ç»Ÿè§„åˆ’

### 4.1 æ ·å¼æ–‡ä»¶ç»„ç»‡

```
styles/
â”œâ”€ global.css              (å·²æœ‰ï¼ŒåŸºç¡€æ ·å¼)
â”œâ”€ codeblock.css           (å·²æœ‰)
â”œâ”€ list.css               (å·²æœ‰)
â”œâ”€ blockquote.css         (å·²æœ‰)
â”œâ”€ highlight.css          (æ–°å¢ï¼Œé«˜äº®)
â”œâ”€ image.css              (æ–°å¢ï¼Œå›¾ç‰‡)
â”œâ”€ table.css              (æ–°å¢ï¼Œè¡¨æ ¼)
â”œâ”€ textalign.css          (æ–°å¢ï¼Œå¯¹é½)
â”œâ”€ collaboration.css      (æ–°å¢ï¼Œåä½œå…‰æ ‡)
â”œâ”€ toolbar.css            (æ–°å¢ï¼Œå·¥å…·æ )
â””â”€ statusbar.css          (æ–°å¢ï¼ŒçŠ¶æ€æ )
```

### 4.2 è®¾è®¡ç³»ç»Ÿè§„èŒƒ

#### é¢œè‰²ç³»ç»Ÿ
```
ä¸»è‰²: #6366f1 (Indigo-500)
è¾…åŠ©è‰²: #3b82f6 (Blue-500)
æˆåŠŸ: #10b981 (Green-500)
è­¦å‘Š: #f59e0b (Amber-500)
é”™è¯¯: #ef4444 (Red-500)

èƒŒæ™¯: #ffffff / #1f2937 (Dark)
è¾¹æ¡†: #e5e7eb / #4b5563 (Dark)
æ–‡å­—: #1f2937 / #e5e7eb (Dark)
```

#### é—´è·ç³»ç»Ÿ
```
xs: 4px
sm: 8px
md: 12px
lg: 16px
xl: 24px

blocké—´è·: 8px (margin)
å—å†…padding: 0 (ç´§å‡‘)
```

#### åœ†è§’ç³»ç»Ÿ
```
sm: 4px (æŒ‰é’®ã€è¾“å…¥æ¡†)
md: 6px (å¡ç‰‡)
lg: 8px (å¤§å®¹å™¨)
xl: 12px (å›¾ç‰‡ã€è¡¨æ ¼)
```

---

## ç¬¬äº”éƒ¨åˆ†ï¼šå®ç°è·¯çº¿å›¾

### Phase 1: åŸºç¡€å®Œå–„ (å½“å‰)
âœ… **å·²å®Œæˆ**:
- StarterKit
- Underline, Link
- TaskList/TaskItem
- æ–œæ èœå•åŸºç¡€
- æµ®åŠ¨å·¥å…·æ åŸºç¡€

ğŸ“Œ **æœ¬é˜¶æ®µé‡ç‚¹** (1-2å‘¨):
1. [ ] é›†æˆ Highlight (æ–‡æœ¬é«˜äº®)
2. [ ] é›†æˆ Image (å›¾ç‰‡ä¸Šä¼ )
3. [ ] é›†æˆ TextAlign (æ–‡æœ¬å¯¹é½)
4. [ ] é›†æˆ CharacterCount (å­—æ•°ç»Ÿè®¡)
5. [ ] ä¼˜åŒ–æµ®åŠ¨å·¥å…·æ UI
6. [ ] åˆ›å»ºç›¸åº”çš„æ ·å¼æ–‡ä»¶

---

### Phase 2: é«˜çº§åŠŸèƒ½ (2-3å‘¨)
ğŸ“Œ **é‡ç‚¹**:
1. [ ] é›†æˆ Table/TableRow/TableHeader/TableCell
2. [ ] è¡¨æ ¼å³é”®èœå•
3. [ ] è¡¨æ ¼è¡Œåˆ—æ“ä½œ
4. [ ] ä¼˜åŒ–è¡¨æ ¼æ ·å¼å’Œäº¤äº’
5. [ ] é”®ç›˜å¿«æ·é”®å®Œå–„

---

### Phase 3: ååŒç¼–è¾‘ (3-4å‘¨)
ğŸ“Œ **é‡ç‚¹**:
1. [ ] æ­å»º WebSocket æœåŠ¡å™¨æˆ–é€‰æ‹©äº‘æ–¹æ¡ˆ
2. [ ] é›†æˆ Collaboration
3. [ ] é›†æˆ CollaborationCursor
4. [ ] ç”¨æˆ·çŠ¶æ€ç®¡ç†
5. [ ] æµ‹è¯•å†²çªè§£å†³å’Œæ€§èƒ½

---

### Phase 4: ä¼˜åŒ–ä¸æ‰©å±• (æŒç»­)
ğŸ“Œ **å†…å®¹**:
1. [ ] é›†æˆ Gapcursor
2. [ ] æ€§èƒ½ä¼˜åŒ– (è™šæ‹Ÿæ»šåŠ¨ã€æ¸²æŸ“ä¼˜åŒ–)
3. [ ] æ— éšœç¢è®¿é—® (A11y)
4. [ ] å¯¼å…¥/å¯¼å‡ºåŠŸèƒ½ (Markdown, HTML, PDF)
5. [ ] æ’ä»¶ç³»ç»Ÿæ”¯æŒ

---

## ç¬¬å…­éƒ¨åˆ†ï¼šæŠ€æœ¯ç»†èŠ‚æŒ‡å—

### 6.1 å›¾ç‰‡æ‰©å±•å®ç°ç¤ºä¾‹

```typescript
// components/ImageUpload.tsx
import Image from '@tiptap/extension-image';

export const CustomImage = Image.extend({
  addAttributes() {
    return {
      ...this.parent?.(),
      alt: { default: '' },
      title: { default: '' },
      width: { default: null },
      height: { default: null },
    };
  },

  parseHTML() {
    return [
      {
        tag: 'img[src]',
        getAttrs: (dom: HTMLElement) => ({
          src: (dom as HTMLImageElement).getAttribute('src'),
          alt: (dom as HTMLImageElement).getAttribute('alt'),
          title: (dom as HTMLImageElement).getAttribute('title'),
          width: (dom as HTMLImageElement).getAttribute('width'),
          height: (dom as HTMLImageElement).getAttribute('height'),
        }),
      },
    ];
  },

  renderHTML({ HTMLAttributes }) {
    return ['img', HTMLAttributes];
  },

  addCommands() {
    return {
      setImage: (options) => ({ commands }) => {
        return commands.insertContent({
          type: this.name,
          attrs: options,
        });
      },

      uploadImage: (file: File) => ({ editor, commands }) => {
        const formData = new FormData();
        formData.append('file', file);

        fetch('/api/upload', { method: 'POST', body: formData })
          .then(res => res.json())
          .then(data => {
            commands.setImage({ src: data.url, alt: file.name });
          });
      },
    };
  },
});
```

### 6.2 è¡¨æ ¼æ‰©å±•é›†æˆç¤ºä¾‹

```typescript
// extensions/index.ts
import Table from '@tiptap/extension-table';
import TableRow from '@tiptap/extension-table-row';
import TableHeader from '@tiptap/extension-table-header';
import TableCell from '@tiptap/extension-table-cell';

export const tableExtensions = [
  Table.configure({
    resizable: false,
    handleWidth: 2,
    cellMinWidth: 50,
    lastColumnResizable: true,
  }),
  TableRow,
  TableHeader,
  TableCell,
];

// åœ¨ useEditor ä¸­ä½¿ç”¨
extensions: [
  StarterKit,
  ...tableExtensions,
]
```

### 6.3 ååŒç¼–è¾‘è®¾ç½®ç¤ºä¾‹

```typescript
// lib/collaboration.ts
import * as Y from 'yjs';
import { WebsocketProvider } from 'y-websocket';

export function setupCollaboration(docName: string) {
  const ydoc = new Y.Doc();
  
  const provider = new WebsocketProvider(
    'ws://localhost:1234',
    docName,
    ydoc
  );

  const yMap = ydoc.getMap('shared');

  return { ydoc, provider, yMap };
}

// åœ¨ useEditor ä¸­ä½¿ç”¨
const { ydoc, provider } = setupCollaboration('my-doc');

extensions: [
  Collaboration.configure({ document: ydoc }),
  CollaborationCursor.configure({
    provider,
    user: {
      name: 'User',
      color: generateColor(),
    },
  }),
]
```

---

## ç¬¬ä¸ƒéƒ¨åˆ†ï¼šéªŒæ”¶æ ‡å‡†

### åŠŸèƒ½éªŒæ”¶
- [ ] æ‰€æœ‰æ‰©å±•æ­£å¸¸åŠ è½½ï¼Œæ— æ§åˆ¶å°é”™è¯¯
- [ ] æ–œæ èœå•è¦†ç›–æ‰€æœ‰æ‰©å±•åŠŸèƒ½
- [ ] é”®ç›˜å¿«æ·é”®å…¨éƒ¨å¯ç”¨
- [ ] å·¥å…·æ æŒ‰é’®é€»è¾‘æ­£ç¡®
- [ ] æ–‡æœ¬æ ·å¼ã€å—å…ƒç´ æ¸²æŸ“æ­£ç¡®

### æ€§èƒ½éªŒæ”¶
- [ ] ç¼–è¾‘å™¨åˆå§‹åŠ è½½æ—¶é—´ < 1s
- [ ] è¾“å…¥å“åº”å»¶è¿Ÿ < 50ms
- [ ] æ’¤é”€é‡åšæµç•…æ— å¡é¡¿
- [ ] å¤§æ–‡æ¡£ (10MB) ä¸å´©æºƒ
- [ ] å†…å­˜å ç”¨ç¨³å®š

### æ ·å¼éªŒæ”¶
- [ ] æµ…è‰²/æ·±è‰²æ¨¡å¼é€‚é…
- [ ] å“åº”å¼è®¾è®¡ (æ‰‹æœº/å¹³æ¿/æ¡Œé¢)
- [ ] è§†è§‰å±‚çº§æ¸…æ™°
- [ ] äº¤äº’åé¦ˆæ˜ç¡®ï¼ˆhover/focus/activeï¼‰
- [ ] åŠ¨ç”»æµç•…ï¼Œä¸å½±å“æ€§èƒ½

### ç”¨æˆ·ä½“éªŒ
- [ ] æ–°ç”¨æˆ·å¯ç›´è§‚ç†è§£æ“ä½œ
- [ ] é«˜é¢‘æ“ä½œå¯é€šè¿‡å¿«æ·é”®å®Œæˆ
- [ ] é”™è¯¯æç¤ºæ¸…æ™°
- [ ] æ’¤é”€æœºåˆ¶å¯é 
- [ ] å†…å®¹è‡ªåŠ¨ä¿å­˜

---

## ç¬¬å…«éƒ¨åˆ†ï¼šç›¸å…³èµ„æº

### Tiptapå®˜æ–¹æ–‡æ¡£
- ä¸»ç«™: https://tiptap.dev
- æ‰©å±•æ–‡æ¡£: https://tiptap.dev/api/extensions
- ç¤ºä¾‹: https://tiptap.dev/examples

### å‚è€ƒäº§å“
- é£ä¹¦æ–‡æ¡£: https://www.feishu.cn
- Craft: https://craft.do
- Notion: https://notion.so
- Obsidian: https://obsidian.md

### å¼€æºé¡¹ç›®å‚è€ƒ
- Tiptapå®˜æ–¹ç¤ºä¾‹ä»“åº“
- ProseMirrorç¤ºä¾‹
- Yjså®˜æ–¹ç¤ºä¾‹

---

## æ€»ç»“

æœ¬æ–‡æ¡£è§„åˆ’äº†ä¸€æ¡æ¸…æ™°çš„æŠ€æœ¯è·¯çº¿ï¼Œé€šè¿‡åˆ†é˜¶æ®µé›†æˆTiptapçš„å®˜æ–¹æ‰©å±•ï¼Œæœ€ç»ˆæ„å»ºä¸€ä¸ªåŠŸèƒ½å®Œæ•´ã€ä½“éªŒä¼˜ç§€çš„åœ¨çº¿æ–‡æ¡£ç¼–è¾‘å™¨ã€‚é‡ç‚¹å¼ºè°ƒäº†ï¼š

1. **æ¨¡å—åŒ–**: æ¯ä¸ªæ‰©å±•ç‹¬ç«‹é…ç½®å’Œæ ·å¼
2. **æ¸è¿›å¢å¼º**: åˆ†é˜¶æ®µå®ç°ï¼Œé¿å…è¿‡åº¦å¤æ‚
3. **ç”¨æˆ·ä½“éªŒ**: å‚è€ƒè¡Œä¸šé¢†å…ˆäº§å“è®¾è®¡
4. **æ€§èƒ½è€ƒé‡**: ä»æ¶æ„å¼€å§‹é‡è§†æ€§èƒ½
5. **å¯ç»´æŠ¤æ€§**: æ¸…æ™°çš„ä»£ç ç»„ç»‡å’Œæ–‡æ¡£

é€šè¿‡éµå¾ªæœ¬æ–¹æ¡ˆï¼Œå¯ä»¥é«˜æ•ˆåœ°å°†Zkansoå‘å±•æˆä¸ºä¸€ä¸ªå¼ºå¤§çš„å¯Œæ–‡æœ¬ç¼–è¾‘å¹³å°ã€‚
